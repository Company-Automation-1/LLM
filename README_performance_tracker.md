# MNIST神经网络训练性能追踪工具

这个工具用于追踪MNIST神经网络训练过程中各个函数的性能表现，包括执行时间和调用次数等信息。通过这些信息，可以帮助您分析训练过程中的性能瓶颈，从而优化训练代码。

## 功能特点

- **数据集控制**：可以限制训练样本数量，加快训练速度
- **性能追踪**：记录各函数执行时间和调用次数
- **性能报告**：生成详细的性能报告，包括函数调用次数、执行时间等
- **可视化**：自动生成性能图表，直观展示各函数的性能占比
- **参数配置**：支持通过命令行或交互式界面自定义训练参数

## 使用方法

### 方法一：使用交互式界面

最简单的方法是运行提供的交互式界面，它提供了多种预设配置和自定义配置选项：

```bash
python run_training.py
```

通过菜单选择不同的训练配置：
1. 快速测试 (1000样本, 3轮)
2. 标准测试 (5000样本, 5轮)
3. 完整测试 (所有样本, 10轮)
4. 自定义配置
5. 查看上次训练的性能报告

### 方法二：直接运行训练脚本

您也可以直接运行训练脚本，通过命令行参数自定义训练配置：

```bash
python src/train_mnist_with_tracking.py --samples 5000 --epochs 5 --batch-size 64 --learning-rate 0.01 --hidden-size 100
```

参数说明：
- `--samples`：训练样本数量，设置为-1表示使用全部数据集（默认：5000）
- `--batch-size`：批次大小（默认：64）
- `--epochs`：训练轮数（默认：5）
- `--learning-rate`：初始学习率（默认：0.01）
- `--hidden-size`：隐藏层大小（默认：100）

## 输出文件

训练完成后，以下文件将保存在`results`目录中：

- `mnist_model.pth`：训练好的模型参数
- `training_curves.png`：训练过程中的损失和准确率曲线
- `performance_report.csv`：详细的性能报告数据
- `performance_charts.png`：性能可视化图表

## 性能报告内容

性能报告包含以下信息：

- **函数名**：被追踪的函数名称
- **调用次数**：函数被调用的总次数
- **总执行时间(秒)**：函数的总执行时间
- **平均执行时间(秒)**：每次调用的平均执行时间
- **占总时间百分比**：该函数占整个训练时间的百分比

## 图表说明

性能图表包含四个子图：

1. **前5个函数执行时间占比**：饼图，显示耗时最多的5个函数的时间占比
2. **前10个函数调用次数**：条形图，显示调用次数最多的10个函数
3. **前10个函数平均执行时间**：条形图，显示平均执行时间最长的10个函数
4. **前10个函数总执行时间**：条形图，显示总执行时间最长的10个函数

## 系统要求

- Python 3.6+
- PyTorch
- NumPy
- Matplotlib
- Pandas
- tqdm

## 注意事项

1. 训练时间取决于您的硬件配置和选择的样本数量
2. 对于完整测试，建议使用GPU加速训练过程
3. 如果您遇到内存不足的问题，请尝试减少样本数量或批次大小 